# 木材（一枚板）在庫管理アプリ 要件定義書

## 1. プロジェクト概要

### 1.1 目的
住宅建設会社の工務部における一枚板（木製家具用）の在庫管理を効率化するWebアプリケーションを開発する。

### 1.2 背景・課題
- 現在はExcelで在庫管理しているが、データの整合性維持が困難
- 一枚板は全て一点もの（同一製品が存在しない）のため、個別管理が必要
- 写真をExcelに直接貼り付けており、ファイルサイズが肥大化
- EC販売との在庫連携ができていない
- 加工費の内訳管理が複雑
- 棚卸し作業が非効率（目視確認が必要）

### 1.3 技術スタック
- **フロントエンド**: HTML / CSS / JavaScript（レスポンシブデザイン）
- **バックエンド**: Google Apps Script (GAS)
- **データベース**: Google スプレッドシート
- **デプロイ**: clasp（スタンドアローン）
- **スプレッドシートID**: スクリプトプロパティで管理

---

## 2. ユーザー要件

### 2.1 利用者
- 工務部社員（10名未満）
- 営業担当者（顧客への商品提案時）

### 2.2 利用デバイス
**全デバイス対応のレスポンシブデザイン必須**

| デバイス | 画面幅 | 主な用途 |
|----------|--------|----------|
| スマートフォン | 〜767px | 棚卸し、QRスキャン、在庫確認 |
| タブレット | 768px〜1023px | 現場での登録作業、商談時のカタログ閲覧 |
| PC | 1024px〜 | データ登録、レポート出力、管理業務 |

---

## 3. UI/UXデザイン要件

### 3.1 デザインコンセプト
**「木の温もり × 直感的操作」**

一枚板を扱う業務にふさわしい、温かみのある自然素材をイメージしたデザイン。
現場作業者が手袋をしたままでも操作しやすい、大きなタップ領域と明確なコントラスト。

### 3.2 カラーパレット

```css
:root {
  /* メインカラー（木目調） */
  --color-primary: #8B5A2B;        /* シエナブラウン */
  --color-primary-dark: #5D3A1A;   /* ダークウォルナット */
  --color-primary-light: #D4A574;  /* ライトオーク */
  
  /* アクセントカラー */
  --color-accent: #2E7D32;         /* フォレストグリーン */
  --color-accent-light: #81C784;   /* ライトグリーン */
  
  /* ベースカラー */
  --color-bg-primary: #FFFBF5;     /* アイボリーホワイト */
  --color-bg-secondary: #F5EFE6;   /* クリームベージュ */
  --color-bg-card: #FFFFFF;        /* ホワイト */
  
  /* テキストカラー */
  --color-text-primary: #2C2416;   /* ダークブラウン */
  --color-text-secondary: #6B5B4D; /* ミディアムブラウン */
  --color-text-muted: #9C8B7A;     /* ライトブラウン */
  
  /* ステータスカラー */
  --color-success: #4CAF50;
  --color-warning: #FF9800;
  --color-error: #E53935;
  --color-info: #1976D2;
  
  /* ボーダー・シャドウ */
  --color-border: #E0D5C7;
  --shadow-sm: 0 1px 3px rgba(44, 36, 22, 0.08);
  --shadow-md: 0 4px 12px rgba(44, 36, 22, 0.12);
  --shadow-lg: 0 8px 24px rgba(44, 36, 22, 0.16);
}
```

### 3.3 タイポグラフィ

```css
:root {
  /* 日本語フォント */
  --font-primary: 'Noto Sans JP', 'Hiragino Kaku Gothic ProN', 'メイリオ', sans-serif;
  --font-display: 'Zen Maru Gothic', 'Noto Sans JP', sans-serif;  /* 見出し用 */
  
  /* フォントサイズ */
  --text-xs: 0.75rem;    /* 12px */
  --text-sm: 0.875rem;   /* 14px */
  --text-base: 1rem;     /* 16px */
  --text-lg: 1.125rem;   /* 18px */
  --text-xl: 1.25rem;    /* 20px */
  --text-2xl: 1.5rem;    /* 24px */
  --text-3xl: 1.875rem;  /* 30px */
  
  /* 行間 */
  --leading-tight: 1.25;
  --leading-normal: 1.6;
  --leading-relaxed: 1.8;
}
```

### 3.4 レスポンシブブレークポイント

```css
/* モバイルファースト */
/* スマートフォン: デフォルト */

/* タブレット */
@media (min-width: 768px) { }

/* PC */
@media (min-width: 1024px) { }

/* 大画面PC */
@media (min-width: 1280px) { }
```

### 3.5 UIコンポーネント設計

#### ボタン
```css
.btn {
  min-height: 48px;           /* タップしやすい高さ */
  min-width: 48px;
  padding: 12px 24px;
  border-radius: 8px;
  font-weight: 600;
  transition: all 0.2s ease;
}

/* プライマリボタン */
.btn-primary {
  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
  color: white;
  box-shadow: var(--shadow-sm);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

/* セカンダリボタン */
.btn-secondary {
  background: var(--color-bg-card);
  color: var(--color-primary);
  border: 2px solid var(--color-primary);
}
```

#### カード
```css
.card {
  background: var(--color-bg-card);
  border-radius: 12px;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--color-border);
  overflow: hidden;
  transition: all 0.3s ease;
}

.card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
}

/* 製品カード（写真付き） */
.product-card {
  display: grid;
  grid-template-rows: 200px auto;
}

@media (min-width: 768px) {
  .product-card {
    grid-template-rows: 250px auto;
  }
}
```

#### フォーム入力
```css
.form-input {
  width: 100%;
  min-height: 48px;
  padding: 12px 16px;
  border: 2px solid var(--color-border);
  border-radius: 8px;
  font-size: var(--text-base);
  background: var(--color-bg-card);
  transition: all 0.2s ease;
}

.form-input:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(139, 90, 43, 0.15);
}

.form-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--color-text-primary);
}
```

#### ナビゲーション
```css
/* モバイル: 下部固定タブバー */
.mobile-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 64px;
  background: var(--color-bg-card);
  border-top: 1px solid var(--color-border);
  display: flex;
  justify-content: space-around;
  align-items: center;
  z-index: 1000;
}

/* PC: サイドバー */
@media (min-width: 1024px) {
  .mobile-nav {
    display: none;
  }
  
  .sidebar {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    width: 260px;
    background: var(--color-bg-card);
    border-right: 1px solid var(--color-border);
    padding: 24px 0;
  }
}
```

### 3.6 アニメーション・マイクロインタラクション

```css
/* ページ読み込みアニメーション */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-in {
  animation: fadeInUp 0.4s ease-out forwards;
}

/* スタガードアニメーション（リスト表示） */
.list-item:nth-child(1) { animation-delay: 0.05s; }
.list-item:nth-child(2) { animation-delay: 0.1s; }
.list-item:nth-child(3) { animation-delay: 0.15s; }
/* ... */

/* ローディングスピナー */
@keyframes spin {
  to { transform: rotate(360deg); }
}

.spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--color-border);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* 成功フィードバック */
@keyframes success-pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.success-feedback {
  animation: success-pulse 0.3s ease;
}
```

### 3.7 アクセシビリティ

- フォーカス状態の明確な視覚的表示
- タッチターゲット最小48px × 48px
- 色のコントラスト比 WCAG AA準拠（4.5:1以上）
- フォームラベルの適切な関連付け
- エラーメッセージは色だけでなくアイコン・テキストでも表示

---

## 4. 機能要件

### 4.1 製品マスター管理

#### 4.1.1 製品登録
一枚板の新規登録機能

**入力項目:**

| 項目名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| 製品ID | 文字列 | ○ | 自動採番（例: ITA-0001） |
| 大分類 | 選択式 | ○ | テーブル/カウンター/スツール/足/その他 |
| 中分類 | 選択式 | - | 家具/雑貨/加工材料/その他 |
| 商品名 | 文字列 | ○ | 自由入力 |
| 樹種 | 選択式 | ○ | マスターから選択（その他も可） |
| 入荷時サイズ（長さ） | 数値 | - | mm単位 |
| 入荷時サイズ（幅） | 数値 | - | mm単位 |
| 入荷時サイズ（厚み） | 数値 | - | mm単位 |
| 仕上げ後サイズ（長さ） | 数値 | - | mm単位 |
| 仕上げ後サイズ（幅） | 数値 | - | mm単位 |
| 仕上げ後サイズ（厚み） | 数値 | - | mm単位 |
| 入荷時写真 | 画像URL | - | Googleドライブリンク |
| 仕上げ後写真 | 画像URL | - | Googleドライブリンク |
| 仕入れ先 | 選択式 | ○ | マスターから選択 |
| 仕入れ日 | 日付 | ○ | yyyy/mm/dd形式 |
| 入荷単価 | 数値 | ○ | 税抜き価格 |
| 保管場所 | 選択式 | ○ | マスターから選択 |
| ステータス | 選択式 | ○ | 販売中/販売済み（初期値: 販売中） |
| 備考 | 文字列 | - | 自由入力 |

#### 4.1.2 製品編集
登録済み製品の情報更新機能

**編集可能項目:**
- 基本情報（商品名、樹種、大分類、中分類）
- サイズ情報（入荷時・仕上げ後）
- 写真（入荷時・仕上げ後）
- 価格情報（販売時送料、利益率、価格調整額）
- 保管場所
- 備考

**編集不可項目（システム管理）:**
- 製品ID
- 仕入れ先
- 仕入れ日
- 入荷単価
- 作成日時

**編集時の動作:**
- 更新日時を自動更新
- 編集前の値をステータス変更履歴に記録（主要項目のみ）
- 保管場所変更時は移動履歴に記録

#### 4.1.3 製品削除（論理削除）
誤登録時の対応機能

**削除時の動作:**
- 物理削除は行わず、ステータスを「削除済み」に変更
- 削除日時を記録
- 削除理由（必須）を入力
- 削除済み製品は通常の一覧には表示しない（管理者メニューから確認可能）
- 関連する加工費データは保持（履歴として）

**削除可能な条件:**
- ステータスが「販売中」の製品のみ
- 「販売済み」の製品は削除不可（履歴保持のため）
- 「棚卸し中」の製品は削除不可

**削除取り消し:**
- 削除済み製品を「販売中」に復元可能
- 復元時は復元理由を記録

#### 4.1.4 製品検索・絞り込み

**基本絞り込み条件:**
- 大分類/中分類による絞り込み
- 樹種による絞り込み
- 保管場所による絞り込み
- ステータスによる絞り込み（販売中/販売済み/棚卸し中/削除済み）
- フリーワード検索（商品名）

**詳細検索条件:**

| 検索項目 | 検索方式 | 説明 |
|----------|----------|------|
| 製品ID | 部分一致 | 前方一致・部分一致選択可 |
| 商品名 | 部分一致 | キーワード複数指定可（AND/OR） |
| 樹種 | 完全一致 | 複数選択可 |
| 大分類/中分類 | 完全一致 | 複数選択可 |
| 保管場所 | 完全一致 | 複数選択可 |
| 仕入れ先 | 完全一致 | 複数選択可 |
| 仕入れ日 | 範囲指定 | 開始日〜終了日 |
| 入荷単価 | 範囲指定 | 最小〜最大 |
| サイズ（長さ/幅/厚み） | 範囲指定 | 最小〜最大（入荷時/仕上げ後選択可） |
| 販売価格（税込） | 範囲指定 | 最小〜最大 |
| 在庫日数 | 範囲指定 | 仕入れ日からの経過日数 |

**ソート機能:**

| ソート項目 | デフォルト | 説明 |
|------------|------------|------|
| 登録日時 | 降順 | 新しい順（デフォルト） |
| 仕入れ日 | 昇順/降順 | |
| 入荷単価 | 昇順/降順 | |
| 販売価格 | 昇順/降順 | |
| 商品名 | 昇順/降順 | あいうえお順 |
| 製品ID | 昇順/降順 | |
| 在庫日数 | 降順 | 長期在庫順 |

**検索結果:**
- ページネーション（1ページあたり20件、変更可能: 20/50/100件）
- 検索条件の保存・呼び出し機能
- 検索結果の件数表示
- 検索結果からのCSV出力

---

### 4.2 加工費管理

#### 4.2.1 加工費登録
製品ごとの加工費を内訳付きで登録

**入力項目:**

| 項目名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| 製品ID | 文字列 | ○ | 親製品への紐付け |
| 加工種別 | 選択式 | ○ | 木材加工/塗装/足/ガラス/その他 |
| 加工業者 | 選択式 | ○ | マスターから選択（種別で絞り込み） |
| 加工内容 | 文字列 | - | 詳細内容（自由入力） |
| 金額 | 数値 | ○ | 税抜き価格（送料込みの場合は込みで登録） |
| 登録日 | 日付 | ○ | 自動設定 |

**機能:**
- 1製品に対して複数の加工費を登録可能
- 加工費合計を自動計算

#### 4.2.2 加工費編集
登録済み加工費の情報更新機能

**編集可能項目:**
- 加工種別
- 加工業者
- 加工内容
- 金額

**編集時の動作:**
- 変更前後の値を操作ログに記録
- 関連製品のトータル原価・販売価格を自動再計算

#### 4.2.3 加工費削除
誤登録時の対応機能

**削除時の動作:**
- 確認ダイアログ表示（「この加工費を削除すると、製品の原価・販売価格が再計算されます。よろしいですか？」）
- 削除後、関連製品のトータル原価・販売価格を自動再計算
- 削除履歴を操作ログに記録

**削除可能な条件:**
- 関連製品のステータスが「販売中」または「削除済み」の場合のみ
- 「販売済み」の製品に紐づく加工費は削除不可（実績データ保持のため）

---

### 4.3 原価・販売価格計算

#### 4.3.1 自動計算項目

| 項目名 | 計算式 |
|--------|--------|
| 加工費合計 | 該当製品の加工費テーブル合計 |
| トータル原価 | 入荷単価 + 加工費合計 + 販売時送料 |
| 目安販売価格（税抜） | トータル原価 ÷ (1 - 利益率) |
| 販売価格（税抜） | 目安販売価格 + 価格調整額 |
| 販売価格（税込） | 販売価格（税抜） × 1.1 |

#### 4.3.2 手動入力項目

| 項目名 | 説明 |
|--------|------|
| 販売時送料 | 顧客への配送料 |
| 利益率 | デフォルト60%、変更可能 |
| 価格調整額 | 値引き（マイナス）または上乗せ（プラス） |

---

### 4.4 写真管理

#### 4.4.1 写真アップロード

**対応形式:**
- JPEG (.jpg, .jpeg)
- PNG (.png)
- WebP (.webp)

**制限事項:**

| 項目 | 制限値 | 説明 |
|------|--------|------|
| 最大ファイルサイズ | 10MB/枚 | 超過時はエラー表示 |
| 最大枚数/種別 | 5枚 | 入荷時写真、仕上げ後写真それぞれ5枚まで |
| 推奨解像度 | 長辺1200px | 超過時は自動リサイズ |
| 自動リサイズ | 長辺2400px超 | 2400pxに縮小して保存 |

**アップロード時の処理:**
1. ファイル形式・サイズのバリデーション
2. 自動リサイズ（条件該当時）
3. EXIFデータに基づく自動回転補正
4. Googleドライブへのアップロード
5. 共有URLの取得・保存
6. サムネイル用URLの生成

#### 4.4.2 写真表示

**表示モード:**
- サムネイル表示（一覧画面：横幅200px）
- 詳細表示（詳細画面：横幅600px）
- 拡大表示（モーダル：画面幅に応じた最大サイズ）
- スワイプ対応（複数枚の場合、モバイルでスワイプ切替）

**代替表示:**
- 写真未登録時: プレースホルダー画像（「写真なし」アイコン）
- 読み込みエラー時: エラーアイコン + 「再読み込み」ボタン
- 読み込み中: スケルトンローダー表示

#### 4.4.3 写真の削除・差替え

**削除機能:**
- 個別削除（1枚ずつ）
- 確認ダイアログ表示
- 削除後、Googleドライブからも削除（完全削除）
- 削除履歴を操作ログに記録

**差替え機能:**
- 既存写真を新しい写真に置き換え
- 旧写真はGoogleドライブから削除
- 差替え履歴を操作ログに記録

**メイン写真の設定:**
- 複数枚登録時、1枚をメイン写真として設定可能
- メイン写真は一覧・カタログで優先表示
- 未設定時は1枚目をメイン写真として扱う

#### 4.4.4 写真の保存先管理

**フォルダ構成:**
```
/木材在庫/
  └── [年月]/          例: 2026-01/
      └── [製品ID]/    例: ITA-0001/
          ├── raw/     入荷時写真
          └── finished/仕上げ後写真
```

**ファイル命名規則:**
- `{製品ID}_{種別}_{連番}_{タイムスタンプ}.{拡張子}`
- 例: `ITA-0001_raw_01_20260116123456.jpg`

---

### 4.5 QRコード機能

#### 4.5.1 QRコード生成
- 製品登録完了後、製品IDをQRコード化
- 印刷用フォーマットで出力（ラベルシール想定）

#### 4.5.2 QRコードスキャン
- スマートフォン/タブレットのカメラでスキャン
- スキャン後、該当製品の詳細情報を表示

---

### 4.6 棚卸し機能

#### 4.6.1 棚卸し開始

**開始条件:**
- 保管場所を選択して棚卸しセッションを開始
- 同一保管場所で進行中の棚卸しがある場合は警告表示
- 複数人での同時作業を許可（同一セッションに参加）

**開始時の処理:**
- 棚卸しセッションIDを発行
- 対象製品（該当保管場所の「販売中」製品）の一覧を取得
- 対象製品のステータスを「棚卸し中」に変更
- 開始日時・担当者を記録

**棚卸し中の制限:**
- 「棚卸し中」の製品は販売処理不可
- 「棚卸し中」の製品は保管場所変更不可
- 「棚卸し中」の製品の編集は限定的に可（備考のみ）

#### 4.6.2 棚卸し実施

**確認方法:**
1. QRコードスキャン（推奨）
2. 製品ID手入力
3. 一覧から選択

**確認時の記録:**
- 確認日時
- 確認者（Googleアカウント名）
- 確認方法（スキャン/手入力/一覧選択）

**画面表示:**
- 未確認製品数 / 確認済み製品数 / 合計
- 進捗バー表示
- 未確認製品一覧（写真・商品名・製品ID表示）
- 確認済み製品一覧（確認時刻表示）

#### 4.6.3 棚卸し中断・再開

**中断機能:**
- 途中で中断可能（進捗は保持）
- 中断理由を任意で記録
- 中断後も別ユーザーが再開可能

**再開機能:**
- 中断したセッションを選択して再開
- 前回の進捗状態から継続
- 再開日時・担当者を記録

#### 4.6.4 棚卸し完了

**完了条件:**
- 全製品の確認完了、または差異を確定
- 差異がある場合は差異調整が必要

**差異調整:**

| 差異種別 | 対応方法 | 説明 |
|----------|----------|------|
| 未確認（実在庫なし） | 紛失処理 | ステータスを「紛失」に変更、理由を記録 |
| 未確認（場所違い） | 保管場所変更 | 実際の保管場所に移動登録 |
| 未登録発見 | 新規登録 | 未登録製品として新規登録を促す |

**完了時の処理:**
- 対象製品のステータスを「販売中」に戻す
- 棚卸し完了日時を記録
- 各製品の最終棚卸し日を更新
- 差異レポートを自動生成

#### 4.6.5 棚卸し結果・レポート

**棚卸し履歴:**
- 過去の棚卸しセッション一覧
- セッションごとの確認件数・差異件数
- 差異調整の内容

**差異レポート出力:**
- 紛失製品リスト
- 保管場所変更リスト
- 未登録発見リスト

**棚卸しアラート:**
- 最終棚卸しから90日以上経過した保管場所を警告表示
- ダッシュボードに「棚卸し推奨」として表示

---

### 4.7 販売処理

#### 4.7.1 販売登録

**入力項目:**

| 項目名 | データ型 | 必須 | 説明 |
|--------|----------|------|------|
| 販売先 | 文字列 | ○ | 顧客名（フリー入力） |
| 売上計上日 | 日付 | ○ | デフォルトは当日 |
| 実際販売価格（税込） | 数値 | - | 計算値と異なる場合のみ入力 |
| 販売備考 | 文字列 | - | 取引に関する備考 |

**販売登録時の処理:**
- ステータスを「販売済み」に変更
- 販売日時・販売者を記録
- 販売済みデータは履歴として保持（削除しない）
- 操作ログに記録

**確認ダイアログ:**
- 製品情報サマリー（写真・商品名・販売価格）を表示
- 「この製品を販売済みにしますか？」確認

#### 4.7.2 一括販売処理

**対象:**
- 複数製品をまとめて同一顧客に販売する場合

**操作フロー:**
1. 製品一覧で対象製品を複数選択（チェックボックス）
2. 「一括販売」ボタンをクリック
3. 共通の販売情報を入力（販売先、売上計上日）
4. 確認画面で選択製品一覧と合計金額を表示
5. 確定処理

**制限:**
- 一度に処理できる最大件数: 20件
- 「販売中」ステータスの製品のみ選択可能

#### 4.7.3 販売キャンセル

**キャンセル条件:**
- 販売登録から7日以内
- キャンセル理由（必須）を入力

**キャンセル時の処理:**
- ステータスを「販売中」に戻す
- 販売情報（販売先、売上計上日）をクリア
- キャンセル理由・キャンセル日時を履歴に記録
- 操作ログに記録

**キャンセル履歴の保持:**
- キャンセルした販売の履歴は保持
- 「キャンセル済み販売一覧」で確認可能

---

### 4.8 出力機能

#### 4.8.1 PDF出力（カタログ）
顧客向けの商品カタログ出力

**表示項目（顧客向け）:**
- 写真（入荷時/仕上げ後）
- 商品名
- 樹種
- サイズ（仕上げ後）
- 販売価格（税込）

**条件:**
- 原価情報は非表示
- 大分類/中分類で絞り込み可能

#### 4.8.2 CSV出力（EC連携用）
EC販売サイトへのインポート用データ出力

#### 4.8.3 在庫レポート出力
- 保管場所別在庫金額
- カテゴリ別在庫金額
- 月末在庫数・金額

#### 4.8.4 売上レポート出力
- 期間指定での売上一覧
- 販売先別売上集計

---

### 4.9 マスターデータ管理

#### 4.9.1 樹種マスター
| 初期データ |
|------------|
| ウォルナット |
| モンキーポッド |
| 杉 |
| 欅 |
| ポプラ |
| パイン |
| その他 |

※追加登録可能

#### 4.9.2 仕入れ先マスター
| 項目 |
|------|
| 業者名 |
| 連絡先 |
| 住所 |
| 備考 |

#### 4.9.3 加工業者マスター
| 項目 |
|------|
| 業者名 |
| 加工種別（複数選択可） |
| 連絡先 |
| 住所 |
| 備考 |

#### 4.9.4 保管場所マスター
| 初期データ |
|------------|
| ショールーム |
| 豊中工場1階 |
| 豊中工場2階 |
| モデルハウスA |
| モデルハウスB |
| その他 |

※追加登録可能

#### 4.9.5 マスターデータの削除

**削除時の影響確認:**
- 削除対象のマスターデータを使用している製品が存在するかチェック
- 使用中の場合は警告表示（「この樹種は10件の製品で使用されています」）
- 使用中のマスターデータは削除不可（製品データの整合性保持のため）

**無効化対応:**
- 削除できないマスターデータは「無効」ステータスに変更可能
- 無効化したマスターは新規選択時に表示されない
- 既存製品での表示は継続

---

### 4.10 入力バリデーションルール

#### 4.10.1 数値項目

| 項目名 | 最小値 | 最大値 | 小数点 | 備考 |
|--------|--------|--------|--------|------|
| サイズ（長さ/幅/厚み） | 1 | 99999 | 不可 | mm単位、整数のみ |
| 入荷単価 | 0 | 99999999 | 不可 | 円単位、整数のみ |
| 加工費金額 | 0 | 99999999 | 不可 | 円単位、整数のみ |
| 販売時送料 | 0 | 9999999 | 不可 | 円単位、整数のみ |
| 利益率 | 0 | 99 | 可（1桁） | %単位 |
| 価格調整額 | -9999999 | 9999999 | 不可 | 円単位、マイナス可 |

#### 4.10.2 文字列項目

| 項目名 | 最小文字数 | 最大文字数 | 禁止文字 |
|--------|------------|------------|----------|
| 商品名 | 1 | 100 | なし |
| 備考 | 0 | 500 | なし |
| 販売先 | 1 | 100 | なし |
| 加工内容 | 0 | 200 | なし |
| 業者名 | 1 | 50 | なし |
| 連絡先 | 0 | 100 | なし |
| 住所 | 0 | 200 | なし |

#### 4.10.3 必須項目チェック

**製品登録時の必須項目:**
- 大分類、商品名、樹種、仕入れ先、仕入れ日、入荷単価、保管場所

**加工費登録時の必須項目:**
- 加工種別、加工業者、金額

**販売登録時の必須項目:**
- 販売先、売上計上日

#### 4.10.4 重複チェック

| 対象 | チェック内容 | エラーメッセージ |
|------|--------------|------------------|
| 製品ID | 完全一致で重複不可 | 「この製品IDは既に使用されています」 |
| 樹種名 | 完全一致で重複不可 | 「この樹種名は既に登録されています」 |
| 業者名 | 完全一致で重複不可 | 「この業者名は既に登録されています」 |
| 保管場所名 | 完全一致で重複不可 | 「この保管場所名は既に登録されています」 |

#### 4.10.5 日付項目

| 項目名 | 制約 |
|--------|------|
| 仕入れ日 | 未来日不可、システム利用開始日以降 |
| 売上計上日 | 仕入れ日以降、未来日は当日+7日まで |
| 棚卸し日 | 未来日不可 |

---

### 4.11 エラーハンドリング定義

#### 4.11.1 バリデーションエラー

**表示方法:**
- フォーム入力項目の直下にエラーメッセージを赤字で表示
- エラーのある入力欄を赤枠でハイライト
- 送信ボタン押下時、最初のエラー項目にフォーカス移動

**エラーメッセージ例:**

| エラー種別 | メッセージ |
|------------|------------|
| 必須未入力 | 「{項目名}を入力してください」 |
| 数値範囲外 | 「{項目名}は{最小値}〜{最大値}の範囲で入力してください」 |
| 文字数超過 | 「{項目名}は{最大文字数}文字以内で入力してください」 |
| 形式不正 | 「{項目名}の形式が正しくありません」 |
| 重複エラー | 「この{項目名}は既に登録されています」 |

#### 4.11.2 通信エラー

**対応方針:**
- タイムアウト: 30秒
- リトライ: 自動リトライ1回、手動リトライボタン表示

**エラーメッセージ:**

| エラー種別 | メッセージ | 対応 |
|------------|------------|------|
| ネットワークエラー | 「通信に失敗しました。インターネット接続を確認してください」 | 再試行ボタン表示 |
| タイムアウト | 「サーバーからの応答がありません。しばらく待ってから再試行してください」 | 再試行ボタン表示 |
| サーバーエラー | 「システムエラーが発生しました。管理者にお問い合わせください」 | エラーコード表示 |

#### 4.11.3 同時編集競合

**検出方法:**
- 更新日時を比較し、取得時から変更があれば競合と判定

**対応:**
- 「この製品は他のユーザーによって更新されました。最新情報を再取得してください」
- 「再取得」ボタンで最新データを取得
- 入力中のデータは破棄される旨を警告

#### 4.11.4 GAS API制限エラー

**対応:**
- 「処理が集中しています。30秒後に自動で再試行します」
- カウントダウン表示
- 自動リトライ（最大3回、間隔30秒）

---

### 4.12 操作ログ機能

#### 4.12.1 記録対象

| 操作種別 | 記録内容 |
|----------|----------|
| 製品登録 | 登録した製品ID、登録者、登録日時 |
| 製品編集 | 編集した製品ID、変更項目・変更前後の値、編集者、編集日時 |
| 製品削除 | 削除した製品ID、削除理由、削除者、削除日時 |
| 加工費登録 | 製品ID、加工費ID、登録者、登録日時 |
| 加工費編集 | 製品ID、加工費ID、変更内容、編集者、編集日時 |
| 加工費削除 | 製品ID、加工費ID、削除者、削除日時 |
| 販売登録 | 製品ID、販売先、販売価格、販売者、販売日時 |
| 販売キャンセル | 製品ID、キャンセル理由、実行者、日時 |
| 棚卸し | セッションID、保管場所、実行者、開始/終了日時 |
| マスター変更 | マスター種別、変更内容、実行者、日時 |

#### 4.12.2 ログの閲覧

**閲覧機能:**
- 操作日時での絞り込み（期間指定）
- 操作種別での絞り込み
- 実行者での絞り込み
- 製品IDでの絞り込み

**表示項目:**
- 操作日時
- 操作種別
- 対象（製品ID等）
- 操作内容詳細
- 実行者

#### 4.12.3 ログの保持期間

- 保持期間: 2年間
- 2年経過したログは自動削除（月次バッチ処理）
- 削除前にCSV形式でバックアップ出力

---

### 4.13 通知・アラート機能

#### 4.13.1 長期在庫アラート

**条件:**
- 仕入れ日から180日以上経過した「販売中」の製品

**通知方法:**
- ダッシュボードに警告表示
- 対象製品数とリストへのリンク表示

#### 4.13.2 棚卸し未実施アラート

**条件:**
- 最終棚卸しから90日以上経過した保管場所

**通知方法:**
- ダッシュボードに警告表示
- 対象保管場所名と最終棚卸し日を表示

#### 4.13.3 処理完了通知

**対象処理:**
- 製品登録完了
- 販売登録完了
- 棚卸し完了
- CSV/PDF出力完了

**通知方法:**
- 画面上部にトースト通知（3秒で自動消去）
- 成功: 緑色背景
- 警告: 黄色背景
- エラー: 赤色背景

---

## 5. 画面構成

### 5.1 画面一覧

| 画面名 | 概要 | 優先デバイス |
|--------|------|-------------|
| ダッシュボード | 在庫サマリー、クイックアクション | 全デバイス |
| 製品一覧 | 在庫製品の一覧表示・検索 | 全デバイス |
| 製品詳細 | 製品情報の詳細表示・編集 | 全デバイス |
| 製品登録 | 新規製品の登録 | PC・タブレット |
| 加工費登録 | 加工費の追加登録 | PC・タブレット |
| 棚卸し | 棚卸し作業画面 | スマホ・タブレット |
| QRスキャン | QRコード読取画面 | スマホ |
| 販売処理 | 販売登録画面 | PC・タブレット |
| 販売済一覧 | 販売履歴の一覧 | 全デバイス |
| マスター管理 | 各種マスターの管理 | PC |
| レポート | 各種レポート出力 | PC |
| カタログ出力 | 顧客向けPDF出力 | PC・タブレット |

### 5.2 画面レイアウト

#### モバイル（〜767px）
```
┌─────────────────────┐
│      ヘッダー        │
│   （ロゴ・メニュー）   │
├─────────────────────┤
│                     │
│                     │
│    メインコンテンツ   │
│                     │
│                     │
├─────────────────────┤
│  固定ボトムナビ(5項目) │
│ 🏠 📦 📷 📋 ⚙️      │
└─────────────────────┘
```

#### タブレット（768px〜1023px）
```
┌─────────────────────────────┐
│         ヘッダー             │
├─────────────────────────────┤
│                             │
│                             │
│       メインコンテンツ        │
│      （2カラムグリッド）       │
│                             │
│                             │
├─────────────────────────────┤
│     固定ボトムナビ（簡易）     │
└─────────────────────────────┘
```

#### PC（1024px〜）
```
┌────────┬────────────────────────┐
│        │        ヘッダー         │
│        ├────────────────────────┤
│        │                        │
│ サイド  │                        │
│ バー    │    メインコンテンツ     │
│ ナビ    │    （3カラムグリッド）   │
│        │                        │
│        │                        │
└────────┴────────────────────────┘
```

---

## 6. ファイル構成

```
木材在庫管理/
├── Code.gs                    # メインエントリーポイント
├── appsscript.json            # GAS設定ファイル
│
├── サーバー/
│   ├── 製品管理.gs            # 製品CRUD処理
│   ├── 加工費管理.gs          # 加工費CRUD処理
│   ├── マスター管理.gs        # マスターデータ処理
│   ├── 棚卸し管理.gs          # 棚卸し処理
│   ├── 販売管理.gs            # 販売処理
│   ├── レポート出力.gs        # 各種レポート生成
│   ├── PDF出力.gs             # PDFカタログ生成
│   ├── CSV出力.gs             # CSVエクスポート
│   └── ユーティリティ.gs      # 共通関数
│
├── 画面/
│   ├── index.html             # メインHTML
│   ├── ダッシュボード.html    # ダッシュボード
│   ├── 製品一覧.html          # 製品一覧画面
│   ├── 製品詳細.html          # 製品詳細画面
│   ├── 製品登録.html          # 製品登録フォーム
│   ├── 加工費登録.html        # 加工費登録フォーム
│   ├── 棚卸し.html            # 棚卸し画面
│   ├── QRスキャン.html        # QRスキャン画面
│   ├── 販売処理.html          # 販売登録画面
│   ├── 販売済一覧.html        # 販売履歴画面
│   ├── マスター管理.html      # マスター管理画面
│   ├── レポート.html          # レポート出力画面
│   └── カタログ出力.html      # カタログ出力画面
│
├── スタイル/
│   ├── 共通.css.html          # 共通スタイル・CSS変数
│   ├── コンポーネント.css.html # UIコンポーネント
│   ├── レイアウト.css.html    # レイアウト・グリッド
│   ├── レスポンシブ.css.html  # メディアクエリ
│   └── アニメーション.css.html # アニメーション定義
│
├── スクリプト/
│   ├── 共通.js.html           # 共通JavaScript
│   ├── API通信.js.html        # サーバー通信処理
│   ├── フォーム.js.html       # フォーム処理
│   ├── 検索絞込.js.html       # 検索・フィルター
│   ├── QRコード.js.html       # QRコード生成・読取
│   ├── 写真アップロード.js.html # 写真処理
│   └── ユーティリティ.js.html # ユーティリティ関数
│
└── テンプレート/
    ├── PDFカタログ.html       # PDF出力用テンプレート
    └── QRラベル.html          # QRコードラベルテンプレート
```

---

## 7. データベース設計

### 7.1 スプレッドシート構成

#### シート1: 製品マスター

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | 製品ID | 文字列 |
| B | 大分類 | 文字列 |
| C | 中分類 | 文字列 |
| D | 商品名 | 文字列 |
| E | 樹種 | 文字列 |
| F | 入荷時_長さ | 数値 |
| G | 入荷時_幅 | 数値 |
| H | 入荷時_厚み | 数値 |
| I | 仕上げ後_長さ | 数値 |
| J | 仕上げ後_幅 | 数値 |
| K | 仕上げ後_厚み | 数値 |
| L | 入荷時写真URL | 文字列 |
| M | 仕上げ後写真URL | 文字列 |
| N | 仕入れ先ID | 文字列 |
| O | 仕入れ日 | 日付 |
| P | 入荷単価 | 数値 |
| Q | 保管場所ID | 文字列 |
| R | 販売時送料 | 数値 |
| S | 利益率 | 数値 |
| T | 価格調整額 | 数値 |
| U | ステータス | 文字列 |
| V | 販売先 | 文字列 |
| W | 売上計上日 | 日付 |
| X | 実際販売価格 | 数値 |
| Y | 販売備考 | 文字列 |
| Z | 最終棚卸し日 | 日付 |
| AA | 削除日時 | 日時 |
| AB | 削除理由 | 文字列 |
| AC | 備考 | 文字列 |
| AD | 作成日時 | 日時 |
| AE | 更新日時 | 日時 |
| AF | 登録者 | 文字列 |
| AG | 更新者 | 文字列 |

**ステータス値:**
- 販売中
- 販売済み
- 棚卸し中
- 削除済み
- 紛失

#### シート2: 加工費詳細

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | 加工費ID | 文字列 |
| B | 製品ID | 文字列 |
| C | 加工種別 | 文字列 |
| D | 加工業者ID | 文字列 |
| E | 加工内容 | 文字列 |
| F | 金額 | 数値 |
| G | 作成日時 | 日時 |

#### シート3: 樹種マスター

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | 樹種ID | 文字列 |
| B | 樹種名 | 文字列 |
| C | 表示順 | 数値 |

#### シート4: 仕入れ先マスター

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | 仕入れ先ID | 文字列 |
| B | 業者名 | 文字列 |
| C | 連絡先 | 文字列 |
| D | 住所 | 文字列 |
| E | 備考 | 文字列 |

#### シート5: 加工業者マスター

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | 加工業者ID | 文字列 |
| B | 業者名 | 文字列 |
| C | 対応加工種別 | 文字列 |
| D | 連絡先 | 文字列 |
| E | 住所 | 文字列 |
| F | 備考 | 文字列 |

#### シート6: 保管場所マスター

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | 保管場所ID | 文字列 |
| B | 場所名 | 文字列 |
| C | 表示順 | 数値 |

#### シート7: 棚卸しセッション

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | セッションID | 文字列 |
| B | 保管場所ID | 文字列 |
| C | 開始日時 | 日時 |
| D | 開始者 | 文字列 |
| E | 完了日時 | 日時 |
| F | 完了者 | 文字列 |
| G | ステータス | 文字列 |
| H | 対象件数 | 数値 |
| I | 確認済件数 | 数値 |
| J | 差異件数 | 数値 |
| K | 備考 | 文字列 |

**ステータス値:**
- 進行中
- 中断中
- 完了

#### シート8: 棚卸し詳細

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | 詳細ID | 文字列 |
| B | セッションID | 文字列 |
| C | 製品ID | 文字列 |
| D | 確認状況 | 文字列 |
| E | 確認方法 | 文字列 |
| F | 確認者 | 文字列 |
| G | 確認日時 | 日時 |
| H | 差異種別 | 文字列 |
| I | 差異理由 | 文字列 |
| J | 対応内容 | 文字列 |

**確認状況値:**
- 未確認
- 確認済み
- 差異あり

**確認方法値:**
- QRスキャン
- 手入力
- 一覧選択

---

### 7.2 追加テーブル（履歴・ログ）

#### シート9: 操作ログ

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | ログID | 文字列 |
| B | 操作種別 | 文字列 |
| C | 対象種別 | 文字列 |
| D | 対象ID | 文字列 |
| E | 操作内容詳細 | 文字列 |
| F | 変更前の値 | 文字列 |
| G | 変更後の値 | 文字列 |
| H | 操作者 | 文字列 |
| I | 操作日時 | 日時 |

**操作種別値:**
- 登録
- 更新
- 削除
- 販売
- キャンセル
- 棚卸し

**対象種別値:**
- 製品
- 加工費
- マスター

#### シート10: 保管場所移動履歴

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | 移動ID | 文字列 |
| B | 製品ID | 文字列 |
| C | 移動元保管場所ID | 文字列 |
| D | 移動先保管場所ID | 文字列 |
| E | 移動登録者 | 文字列 |
| F | 移動日時 | 日時 |
| G | 移動理由 | 文字列 |

#### シート11: 販売キャンセル履歴

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | キャンセルID | 文字列 |
| B | 製品ID | 文字列 |
| C | 元販売先 | 文字列 |
| D | 元売上計上日 | 日付 |
| E | 元販売価格 | 数値 |
| F | キャンセル理由 | 文字列 |
| G | キャンセル実行者 | 文字列 |
| H | キャンセル日時 | 日時 |

#### シート12: 写真管理

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | 写真ID | 文字列 |
| B | 製品ID | 文字列 |
| C | 写真種別 | 文字列 |
| D | 写真URL | 文字列 |
| E | サムネイルURL | 文字列 |
| F | メイン写真フラグ | 真偽値 |
| G | 表示順 | 数値 |
| H | アップロード者 | 文字列 |
| I | アップロード日時 | 日時 |

**写真種別値:**
- 入荷時
- 仕上げ後

#### シート13: シーケンス管理

| 列 | 項目名 | データ型 |
|----|--------|----------|
| A | シーケンス種別 | 文字列 |
| B | プレフィックス | 文字列 |
| C | 現在の番号 | 数値 |
| D | フォーマット | 文字列 |
| E | 更新日時 | 日時 |

**シーケンス種別と初期値:**

| シーケンス種別 | プレフィックス | 初期値 | フォーマット例 |
|----------------|----------------|--------|----------------|
| 製品 | ITA | 1 | ITA-0001 |
| 加工費 | COST | 1 | COST-000001 |
| 棚卸しセッション | INV | 1 | INV-20260116-001 |
| ログ | LOG | 1 | LOG-000000001 |

---

## 8. 非機能要件

### 8.1 パフォーマンス
- 一覧表示: 3秒以内
- 登録/更新処理: 5秒以内
- 想定データ量: 製品5,000件程度

### 8.2 セキュリティ
- Googleアカウント認証
- 社内ドメインのみアクセス可能に設定

### 8.3 写真管理
- 保存先: Googleドライブ（共有ドライブ）
- フォルダ構成: /木材在庫/[年月]/[製品ID]/
- ファイル形式: JPEG/PNG
- 推奨サイズ: 長辺1200px以下

### 8.4 レスポンシブ対応
- モバイルファースト設計
- タッチ操作最適化（タップ領域48px以上）
- 画像の遅延読み込み（Lazy Load）
- オフライン時のエラーハンドリング

### 8.5 GAS制限事項と対応策

#### 8.5.1 実行時間制限

| 制限項目 | 制限値 | 対応策 |
|----------|--------|--------|
| 単一実行時間 | 6分（360秒） | バッチ処理を分割、進捗保存して継続実行 |
| 日次実行時間 | 90分/日 | 重い処理を夜間に分散実行 |
| トリガー実行時間 | 30秒 | Webアプリ経由の処理は30秒以内に設計 |

**対応設計:**
- 一覧取得は1回最大500件に制限
- 大量データ処理はページネーション必須
- 長時間処理は進捗を保存して中断・再開可能に

#### 8.5.2 API制限

| 制限項目 | 制限値 | 対応策 |
|----------|--------|--------|
| スプレッドシート読み取り | 100回/秒 | バッチ読み取りを使用 |
| スプレッドシート書き込み | 100回/秒 | バッチ書き込みを使用 |
| Driveファイル作成 | 1000回/日 | 写真アップロード数を監視 |
| URLフェッチ | 20000回/日 | 外部API呼び出しを最小化 |

**対応設計:**
- setValues/getValuesで一括読み書き
- 個別セル操作を避ける
- キャッシュサービスの活用（CacheService）

#### 8.5.3 データ容量制限

| 制限項目 | 制限値 | 対応策 |
|----------|--------|--------|
| スプレッドシートセル数 | 1000万セル | シート分割、アーカイブ運用 |
| 単一セル文字数 | 50,000文字 | JSON格納時は圧縮を検討 |
| 1行あたり列数 | 推奨50列以下 | テーブル正規化 |

**想定容量計算:**
- 製品マスター: 33列 × 5,000行 = 165,000セル
- 加工費詳細: 7列 × 20,000行 = 140,000セル
- 操作ログ: 9列 × 100,000行 = 900,000セル
- **合計**: 約120万セル（上限の12%、十分な余裕あり）

### 8.6 バックアップ・リカバリ

#### 8.6.1 自動バックアップ

**バックアップ方法:**
- Googleドライブの自動版履歴機能を利用
- スプレッドシートは変更のたびに自動保存

**追加バックアップ（推奨）:**
- 日次でCSV形式の全データをバックアップフォルダに出力
- GASトリガーで毎日深夜2時に自動実行
- 保持期間: 30日間（30世代保持）

**バックアップ対象:**
- 製品マスター
- 加工費詳細
- 棚卸しセッション・詳細
- 操作ログ

#### 8.6.2 リカバリ手順

**軽微な誤操作（直近の変更を戻したい場合）:**
1. スプレッドシートの「ファイル」→「版の履歴」→「版の履歴を表示」
2. 戻したい時点の版を選択
3. 「この版を復元」を実行

**重大な障害（スプレッドシート破損等）:**
1. 日次バックアップCSVから復元用スプレッドシートを作成
2. スクリプトプロパティのスプレッドシートIDを更新
3. 動作確認後、本番運用再開

**リカバリ目標:**
- RPO（目標復旧時点）: 24時間以内
- RTO（目標復旧時間）: 4時間以内

### 8.7 監視・ログ

#### 8.7.1 エラーログ

**記録内容:**
- エラー発生日時
- エラー種別（バリデーション/通信/システム）
- エラーメッセージ
- スタックトレース
- 実行ユーザー
- リクエストパラメータ（機密情報除く）

**保存先:**
- スプレッドシート「エラーログ」シート
- 保持期間: 90日間

**通知:**
- 重大エラー発生時は管理者メールに通知（オプション）

#### 8.7.2 アクセスログ

**記録内容:**
- アクセス日時
- ユーザー（Googleアカウント）
- アクセス画面/機能
- クライアント情報（デバイス種別、ブラウザ）

**保存先:**
- スプレッドシート「アクセスログ」シート
- 保持期間: 90日間

#### 8.7.3 パフォーマンス監視

**監視項目:**
- API応答時間（3秒超過をログ記録）
- データ件数の推移（月次レポート）
- スプレッドシート使用容量

**確認方法:**
- GASの「実行」→「実行数」で実行ログを確認
- ダッシュボードに簡易ステータス表示

---

## 9. 開発フェーズ

### フェーズ1（1月）: 基盤構築
- データベース設計・構築
- 共通CSS/JSの整備
- 製品登録画面
- 製品一覧画面
- 基本的なCRUD機能

### フェーズ2（2月）: 管理機能
- 加工費管理
- マスターデータ管理
- 検索・絞り込み機能
- QRコード生成

### フェーズ3（3月）: 出力・応用機能
- PDFカタログ出力
- 棚卸し機能（QRスキャン）
- 各種レポート出力
- CSV出力（EC連携用）

### フェーズ4（4月〜）: データ移行・運用開始

#### 4.1 データ移行計画

**既存データ状況（想定）:**

| データ種別 | 件数（想定） | 状態 |
|------------|--------------|------|
| 製品データ | 約500件 | 販売中: 300件、販売済み: 200件 |
| 写真データ | 約800枚 | Excel内貼り付け + 一部ドライブ |
| 加工費データ | 約1,500件 | 製品ごとに複数 |
| マスターデータ | 約100件 | 樹種、仕入れ先、加工業者、保管場所 |

#### 4.2 データクレンジング

**実施項目:**

| チェック項目 | 対応方法 |
|--------------|----------|
| 樹種名の表記揺れ | 「ウォールナット」→「ウォルナット」に統一 |
| 空白・スペースの混在 | 前後の空白を除去 |
| 数値の単位不統一 | mm単位に統一（cm表記を変換） |
| 日付形式の不統一 | yyyy/mm/dd形式に統一 |
| 重複データ | 製品IDの重複がないか確認 |
| 必須項目の欠損 | 欠損データをリストアップし、手動補完 |

**クレンジングツール:**
- GASスクリプトで自動変換
- 変換ログを出力し、確認後に本番適用

#### 4.3 移行手順

**Step 1: マスターデータ移行**
1. 既存Excelからマスターデータを抽出
2. クレンジング処理
3. 新システムのマスターシートに投入
4. 検証（件数、内容確認）

**Step 2: 製品データ移行**
1. 既存Excelから製品データを抽出
2. 新システムのカラム形式に変換
3. 製品IDの採番（既存ID or 新規採番を選択）
4. クレンジング処理
5. 新システムの製品マスターに投入
6. 検証（件数、金額合計の一致確認）

**Step 3: 加工費データ移行**
1. 製品データに紐づく加工費を抽出
2. 新システムのカラム形式に変換
3. 製品IDとの紐付け確認
4. 新システムの加工費詳細に投入
5. 検証（製品ごとの加工費合計の一致確認）

**Step 4: 写真データ移行**
1. Excel内の写真を抽出・ファイル化
2. ファイル名を命名規則に従ってリネーム
3. Googleドライブにアップロード
4. 共有URLを取得
5. 製品データの写真URL列を更新
6. 検証（表示確認）

#### 4.4 移行検証

**検証項目:**

| 検証項目 | 方法 | 合格基準 |
|----------|------|----------|
| データ件数 | 旧システムと比較 | 100%一致 |
| 金額合計 | 在庫金額、加工費合計を比較 | 100%一致 |
| 写真表示 | サンプル100件を目視確認 | 95%以上正常表示 |
| 検索動作 | 主要検索パターンでテスト | 正常動作 |
| 帳票出力 | PDF/CSV出力テスト | 内容一致 |

#### 4.5 並行稼働期間

**期間:** 2週間

**運用方法:**
- 新規登録: 新システムのみ
- 参照: 両システムで確認可能
- 毎日EODで差分チェック
- 問題発生時は旧システムにロールバック可能

#### 4.6 本番移行

- ユーザートレーニング実施
- 操作マニュアル配布
- 8月決算までに本稼働完了
- 移行後1ヶ月間はサポート強化期間

---

## 10. 注意事項

### 10.1 開発上の注意
- 列の順番・数は変更時の影響が大きいため、初期設計を慎重に行う
- 写真URLはGoogleドライブのリンク形式で保存
- スプレッドシートIDはスクリプトプロパティで管理し、コードにハードコーディングしない
- CSSはHTML内に`<?!= include('スタイル/共通.css'); ?>`形式でインクルード

### 10.2 運用上の注意
- 樹種マスターは追加可能だが、表記揺れに注意
- 製品の削除は行わず、ステータスで管理
- 加工費は後から追加するケースが多いため、柔軟に対応できる設計とする

### 10.3 運用ルール

#### ID採番ルール

| 種別 | プレフィックス | 形式 | 例 |
|------|----------------|------|-----|
| 製品ID | ITA | ITA-0000 | ITA-0001 |
| 加工費ID | COST | COST-000000 | COST-000001 |
| 棚卸しセッションID | INV | INV-YYYYMMDD-000 | INV-20260116-001 |

**採番ルール変更時の対応:**
- シーケンス管理シートで設定変更
- 既存データへの影響はなし（新規採番から適用）

#### マスターメンテナンス

**責任者:** 工務部管理者（1名指定）

**メンテナンス内容:**
- マスターデータの追加・無効化
- 表記揺れの統一
- 定期的な棚卸し（年1回）

#### データ整理ルール

| 対象データ | 整理タイミング | 処理内容 |
|------------|----------------|----------|
| 操作ログ | 2年経過後 | CSVバックアップ後、削除 |
| エラーログ | 90日経過後 | 自動削除 |
| アクセスログ | 90日経過後 | 自動削除 |
| 販売済み製品 | 保持 | 削除しない（決算・分析用） |
| 削除済み製品 | 3年経過後 | アーカイブ検討 |

### 10.4 ヘルプ機能

#### 操作マニュアル

**提供形式:**
- PDFマニュアル（印刷用）
- アプリ内ヘルプ（画面右上「？」アイコンからアクセス）

**マニュアル構成:**
1. 基本操作ガイド（製品登録、検索、販売処理）
2. 棚卸し作業手順
3. レポート・帳票出力手順
4. トラブルシューティング
5. よくある質問（FAQ）

#### ツールチップ

**対象:**
- 入力フォームの各項目（「？」アイコンをホバー/タップで表示）
- 計算項目（計算式の説明を表示）
- ステータス表示（各ステータスの意味を表示）

#### 初回ログインチュートリアル

**対象:** 初回ログイン時のみ表示

**内容:**
1. ダッシュボードの見方
2. 製品登録の流れ
3. 棚卸し機能の紹介
4. スキップ可能（「次回から表示しない」オプション）

### 10.5 確認ダイアログ仕様

#### 削除確認

**表示条件:** 製品削除、加工費削除、マスターデータ削除時

**ダイアログ内容:**
```
タイトル: 削除の確認
メッセージ: 「{対象名}を削除しますか？」
補足: 「この操作は取り消しできません。」
ボタン: [キャンセル] [削除する]（赤色）
```

**削除理由入力:**
- 削除理由（テキストエリア、必須）
- 選択肢プリセット: 誤登録 / 重複登録 / その他

#### 販売登録確認

**表示条件:** 販売登録実行時

**ダイアログ内容:**
```
タイトル: 販売登録の確認
内容: 製品サムネイル、商品名、販売価格（税込）
メッセージ: 「この製品を販売済みにしますか？」
ボタン: [キャンセル] [販売登録する]
```

#### 一括操作確認

**表示条件:** 一括販売、一括削除時

**ダイアログ内容:**
```
タイトル: 一括操作の確認
内容: 選択件数、対象製品リスト（最大5件表示、残りは「他N件」）
メッセージ: 「{件数}件の製品に対して{操作名}を実行しますか？」
ボタン: [キャンセル] [実行する]
```

---

## 11. 用語集

| 用語 | 説明 |
|------|------|
| 一枚板 | 丸太をスライスした一点ものの木材。テーブルやカウンターの天板に使用 |
| 入荷時 | 木材業者から仕入れた状態（未加工） |
| 仕上げ後 | 研磨・塗装・足取付などの加工完了後の状態 |
| トータル原価 | 入荷単価 + 全ての加工費 + 販売時送料 |
| 利益率 | (販売価格 - 原価) ÷ 販売価格 |

---

## 12. 参考資料

- 既存在庫管理Excel（顧客より共有済み）
- 漆喰在庫管理アプリ（先行開発済み・参考実装）

---

*作成日: 2026年1月16日*
*作成者: PromptSmith*
*最終更新: 2026年1月16日*
*改訂内容: 考慮漏れ項目の追加（入力バリデーション、エラーハンドリング、操作ログ、通知機能、GAS制限対策、バックアップ、データ移行詳細、運用ルール、ヘルプ機能、確認ダイアログ仕様）*
